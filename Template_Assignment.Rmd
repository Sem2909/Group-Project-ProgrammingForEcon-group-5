---
title: "Template"
author: "Studentnames and studentnumbers here"
date: "`r Sys.Date()`"
output: pdf_document
---

# Set-up your environment

```{r package_install, include=FALSE}
install.packages("tidyverse")
```

```{r packages}
require(tidyverse)
```

# Title Page

Include your names

Include the tutorial group number

Include your tutorial lecturer's name

# Part 1 - Identify a Social Problem

Use APA referencing throughout your document. [Here's a link to some explanation.](https://www.mendeley.com/guides/apa-citation-guide/)

## 1.1 Describe the Social Problem

Include the following:

-   Why is this relevant?

-   ...

# Part 2 - Data Sourcing

## 2.1 Load in the data

Data set verkoopprijs:
https://opendata.cbs.nl/#/CBS/nl/dataset/83625NED/table?ts=1748853166332 
We derived the data of the income per municipality by doing the following on the website on CBS. First, open the link to the correct page, then select at the filter “Onderwerp” all of the subjects under the tab “Inkomen en vermogen” (you should see a blue checkmark in a white little box next to “Inkomen en vermogen” and not a blue box). Next, select for “Perioden” all periods. And for “Regio’s” select all of the municipalities (i.e. “gemeenten per provincie”). Then click on “Download” at the right side of the page, and download as a “CSV met statistische symbolen”, this way you have downloaded the excel file with the correct data.

Data set inkomen:
https://opendata.cbs.nl/#/CBS/nl/dataset/70072ned/table?ts=1748937008485 
We derived the data of the housing prices per municipality by doing the following on the website on CBS. First open the second link to the correct page, then select at the filter “Onderwerp” all of the subjects. Next, select for “Perioden” all periods (1995-2023). Then select for “Regio’s” all of the “gemeenten per provincie”, you should see a blue checkmark in a white box at, “gemeenten per provincie” and at every province. So make sure you really have selected all municipalities. Then click on “Download” at the right side of the page, and download as a “CSV met statistische symbolen”, this way you have downloaded the excel file with the correct data.

Data set bevolkingsdichtheid:
https://opendata.cbs.nl/statline/#/CBS/nl/dataset/70072ned/table?ts=1750083971495 
We derived the data of population density by doing the following on the website on CBS. First open the third link to the correct page, then select at the filter 
“Onderwerp” the box called “bevolkingsdichtheid”. To get to this box you have to deselect every subject (so no subjects are selected). then, click on the arrow at “Bevolking”, then on the arrow of “Bevolkingssamenstelling op 1 januari” then choose “bevolkingsdichtheid”. Make sure only bevolkingsdichtheid is selected. Next, select for “Perioden” all periods (1995-2023). Then select for “Regio’s” all of the “gemeenten per provincie”, you should see a blue checkmark in a white box at, “gemeenten per provincie” and at every province. So make sure you really have selected all municipalities. Then click on “Download” at the right side of the page, and download as a “CSV met statistische symbolen”, this way you have downloaded the excel file with the correct data.


```{r loading_data}
data_set_huizenprijzen <- read.csv2("data/Huisprijzen.csv")
data_set_inkomen <- read.csv2("data/Regionale_kerncijfers_Nederland_04062025_092105.csv")

data_set_bevolkingsdichtheid <- read.csv("data/Regionale_kerncijfers_Nederland_16062025_162909.csv")
data_set_bevolkingsdichtheid <- data_set_bevolkingsdichtheid %>%
  separate(
    col = Perioden.Regio.s.Bevolking.Bevolkingssamenstelling.op.1.januari.Bevolkingsdichtheid..aantal.inwoners.per.km..,
    into = c("Perioden", "Regio.s", "Bevolkingsdichtheid"),
    sep = ";"
  ) %>%
  mutate(
    Perioden = as.integer(Perioden),
    Regio.s = trimws(Regio.s),
    Bevolkingsdichtheid = as.numeric(Bevolkingsdichtheid)
  ) %>%
  filter(!is.na(Bevolkingsdichtheid))
```

midwest is an example dataset included in the tidyverse package

## 2.2 Provide a short summary of the dataset(s)

```{r}
head(subset1)
head(subset2)
head(data_set_bevolkingsdichtheid)
```
In this case, we see 4 variables in each dataset. These represent municipality-level indicators related to property values and income. However, we miss some information on the precise definitions or measurement units (e.g., whether income is gross or net, whether housing includes all dwelling types, inflation, etc.).
These details are usually found in the metadata of CBS datasets. For this project, the metadata helps us understand the source, methodology, and relevance of each variable.


``` r
inline_code = TRUE
```

These are things that are usually included in the metadata of the dataset. For your project, you need to provide us with the information from your metadata that we need to understand your dataset of choice.

## 2.3 Describe the type of variables included

We use two datasets from Statistics Netherlands (CBS). The first dataset provides information on the average selling price of houses per municipality, while the second covers average disposable income per household.
Both datasets include the following types of variables:
Categorical variables:
 Municipality (e.g., Amsterdam, Utrecht)
 Year (e.g., 2019, 2020)


Numerical variables:
 Average selling price per dwelling (in euros)
 Average disposable income per household (in thousands of euros)
 Number of dwellings / households


These variables allow us to analyze trends over time and compare municipalities in terms of property values and income levels.


# Part 3 - Quantifying

## 3.1 Data cleaning

Say we want to include only larger distances (above 2) in our dataset, we can filter for this.

```{r data_cleaning}
subset1 <- data_set_huizenprijzen[, 1:3]

# Pak kolommen 1, 2 en 4 uit inkomen, bijvoorbeeld: Regio.s, Perioden, Inkomen
subset2 <- data_set_inkomen[, c(1, 2, 4)]

# Hernoem kolom 3 in subset2 naar Inkomen 
colnames(subset2)[3] <- "Inkomen"

# Merge op Regio.s en Perioden
merged_data <- merge(subset1, subset2, by = c("Regio.s", "Perioden"))

# Verwijder rijen met missende waarden
clean_data <- na.omit(merged_data)

#Blank cells will become NA's
clean_data$Inkomen=as.numeric(clean_data$Inkomen)

#gemiddelde verkoopprijs delen door 1000
clean_data$Gemiddelde.verkoopprijs..euro. = clean_data$Gemiddelde.verkoopprijs..euro. / 1000

#verwijderen van rijen met missende data 
clean_data <- na.omit(clean_data)

```

Please use a separate 'R block' of code for each type of cleaning. So, e.g. one for missing values, a new one for removing unnecessary variables etc.

## 3.2 Generate necessary variables

Variable 1

```{r gen_var1}
clean_data$`Prijs Inkomensratio` <- clean_data[[3]] / clean_data[[4]]
names(clean_data)[names(clean_data) == "Prijs Inkomensratio"] <- "Prijs.Inkomensratio"
```

Variable 2

```{r gen_var2}
clean_data <- clean_data %>%
  arrange(Regio.s, Perioden) %>%
  group_by(Regio.s) %>%
  mutate(
    Groei_Verkoopprijs = (Gemiddelde.verkoopprijs..euro. - lag(Gemiddelde.verkoopprijs..euro.)) / lag(Gemiddelde.verkoopprijs..euro.),
    Groei_Inkomen = (Inkomen - lag(Inkomen)) / lag(Inkomen),
    Groei_PIR = (Prijs.Inkomensratio - lag(Prijs.Inkomensratio)) / lag(Prijs.Inkomensratio)
  ) %>%
  ungroup()
```

## 3.3 Visualize temporal variation

```{r}
# grafiek groei PIR
gemiddelde_groei_per_jaar <- clean_data %>%
  group_by(Perioden) %>%
  summarise(gemiddelde_groei = mean(Groei_PIR, na.rm = TRUE))

ggplot(gemiddelde_groei_per_jaar, aes(x = Perioden, y = gemiddelde_groei)) +
  geom_line(color = "blue", size = 1) +
  geom_smooth(method = "lm", se = FALSE, color = "grey", linetype = "dashed") +
  geom_hline(yintercept = 0, color = "black", size = 0.8) +
  labs(title = "Average growth of the PIR per Year\n",
       x = "Year\n",
       y = "Average growth\n") +
  scale_x_continuous ("Year", breaks = 2011:2023) +
  scale_y_continuous ("Average growth", lim= c(-0.12,0.12)) +
  theme_minimal()

#grafiek groei gemiddelde inkomen
gemiddelde_groei_inkomen_per_jaar <- clean_data %>%
  group_by(Perioden) %>%
  summarise(gemiddelde_groei = mean(Groei_Inkomen, na.rm = TRUE))

ggplot(gemiddelde_groei_inkomen_per_jaar, aes(x = Perioden, y = gemiddelde_groei)) +
  geom_line(color = "blue", size = 1) +
    geom_smooth(method = "lm", se = FALSE, color = "grey", linetype = "dashed") +
  geom_hline(yintercept = 0, color = "black", size = 0.8) +
  labs(title = "Average growth of the income per Year\n",
       x = "Year\n",
       y = "Average growth\n") +
  scale_x_continuous ("Year", breaks = 2011:2023) +
  scale_y_continuous ("Average growth") +
  theme_minimal()
```

## 3.4 Visualize spatial variation

```{r visualise_map}
#nieuwe tabel aangemaakt voor shapefiles
data_2019 <- clean_data %>%
  filter(Perioden == 2019) %>%
  select(Regio.s, PIR_2019 = 5)

data_2023 <- clean_data %>%
  filter(Perioden == 2023) %>%
  select(Regio.s, PIR_2023 = 5)

pir_data <- merge(data_2019, data_2023, by = "Regio.s")

#laad shapefile
gemeente_map <- cbs_get_sf("gemeente", 2023, verbose = TRUE)
head(gemeente_map)

#een nieuwe dataset maken waarbij de juiste data word samengevoegd voor de shapefile om te werken
colnames(pir_data)[which(colnames(pir_data) == "Regio.s")] <- "statnaam"
kaart_met_data <- left_join(gemeente_map, pir_data, by = "statnaam")

ggplot(kaart_met_data) +
  geom_sf(aes(fill = PIR_2019), color = "white") +
  scale_fill_viridis_c(option = "C", na.value = "grey90", breaks = seq(5, 10, by = 1), lim = c(4, 11)) +
  labs(title = "Price/Income Ratio per Municipality (PIR) (2019)\n", fill = "PIR") +
  theme_minimal()

ggplot(kaart_met_data) +
  geom_sf(aes(fill = PIR_2023), color = "white") +
  scale_fill_viridis_c(option = "C", na.value = "grey90", breaks = seq(5, 10, by = 1), lim = c(4, 11)) +
  labs(title = "Price/Income Ratio per Municipality (PIR) (2023)\n", fill = "PIR") +
  theme_minimal()

```

These shapefiles, depicting the price by income ratio (PIR) in 2019 and 2023 in different municipalities, are highly relevant to our social problem to provide a good view of the income differences and house prices in all municipalities in the Netherlands. It clearly shows that in some municipalities it could be easier to buy a home than in other municipalities, that is because the mean salary and the price of homes of all municipalities in the Netherlands are different.
The growth of the PIR across 2019 to 2023 also shows how the ratio changed during these years, which had a big impact on housing affordability and income. This clearly helps with our social problem, because with these shapefiles we are able to clearly depict the social problem on a map and therefore the right measures can be taken on a more specific level, namely on municipality level. 


## 3.5 Visualize sub-population variation

What is the poverty rate by state?

```{r visualise_subpopulations}
dataset$inmetro <- dataset$inmetro %>% as.factor()
# Boxplot of poverty rate by state using the 'midwest' dataset
ggplot(dataset, aes(x = inmetro, y = percadultpoverty)) +
  geom_boxplot() +
  labs(
    title = "Distribution of Poverty Rates by Metropolitan status (Midwest counties)",
    x = "Metropolitan Area",
    y = "Poverty Rate of Adults (%)"
  ) +
  theme_minimal() +
  theme(
    legend.position = "right"
  )
```

Here you provide a description of why the plot above is relevant to your specific social problem.

## 3.6 Event analysis

Analyze the relationship between two variables.

```{r analysis}
# grafiek groei PIR
gemiddelde_groei_per_jaar <- clean_data %>%
  group_by(Perioden) %>%
  summarise(gemiddelde_groei = mean(Groei_PIR, na.rm = TRUE))

ggplot(gemiddelde_groei_per_jaar, aes(x = Perioden, y = gemiddelde_groei)) +
  geom_line(color = "blue", size = 1) +
  geom_smooth(method = "lm", se = FALSE, color = "grey", linetype = "dashed") +
  geom_hline(yintercept = 0, color = "black", size = 0.8) +
  geom_vline(xintercept = 2020, linetype = "dotted", color = "red", size = 1) +
  geom_vline(xintercept = 2022, linetype = "dotted", color = "red", size = 1) +
  labs(title = "Average growth of the PIR per Year\n",
       x = "Year\n",
       y = "Average growth\n") +
  scale_x_continuous ("Year", breaks = 2011:2023) +
  scale_y_continuous ("Average growth", lim= c(-0.12,0.12)) +
  theme_minimal()
```

Here you provide a description of why the plot above is relevant to your specific social problem.

# Part 4 - Discussion

## 4.1 Discuss your findings

# Part 5 - Reproducibility

## 5.1 Github repository link

Provide the link to your PUBLIC repository here: ...

## 5.2 Reference list

Use APA referencing throughout your document.
